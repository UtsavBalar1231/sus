# Advanced Documentation Scraper Configuration
# Comprehensive example showcasing all available features
# Target: Django web framework documentation (large, complex, multi-section site)

# Project metadata
name: django-docs
description: Django framework documentation scraper with advanced features

# Site configuration
site:
  # Multiple entry points for crawling different documentation sections
  start_urls:
    - https://docs.djangoproject.com/en/stable/
    - https://docs.djangoproject.com/en/stable/ref/
    - https://docs.djangoproject.com/en/stable/topics/

  # Restrict to Django documentation domain
  allowed_domains:
    - docs.djangoproject.com

# Advanced crawling rules
crawling:
  # Complex include patterns (whitelist)
  include_patterns:
    # Only scrape stable version (English)
    - pattern: "^/en/stable/"
      type: regex

  # Exclude patterns (blacklist - takes precedence over includes)
  exclude_patterns:
    # Skip other language versions
    - pattern: "^/(es|fr|ja|ko|pt-br|zh-hans)/"
      type: regex

    # Skip old version docs
    - pattern: "^/en/[0-9]+\\.[0-9]/"
      type: regex

    # Skip search and genindex pages (Sphinx artifacts)
    - pattern: "/search/"
      type: prefix
    - pattern: "/genindex/"
      type: prefix
    - pattern: "/_sources/"
      type: prefix
    - pattern: "/_static/"
      type: prefix

    # Skip binary downloads
    - pattern: "*.{pdf,zip,tar.gz,exe,dmg}"
      type: glob

  # Crawl depth limit: how many links deep from start_urls
  # null = unlimited, 0 = only start_urls, 1 = start_urls + direct links, etc.
  depth_limit: null

  # Maximum pages to scrape (Django docs has ~500 pages in stable/en)
  # null = unlimited, set lower for testing
  max_pages: 200

  # Rate limiting: delay between requests to same domain (seconds)
  delay_between_requests: 1.0

  # Global concurrency: total concurrent requests across all domains
  global_concurrent_requests: 16

  # Per-domain concurrency: max concurrent requests per domain
  # Prevents overwhelming a single server
  per_domain_concurrent_requests: 4

  # Retry behavior for failed requests
  max_retries: 5
  retry_backoff: 2.0  # Exponential backoff multiplier (2.0 = 1s, 2s, 4s, 8s, 16s)

  # Respect robots.txt (set false to ignore, but be respectful!)
  respect_robots_txt: true

  # Custom CSS selectors for link extraction
  # Useful for sites with specific navigation structures
  link_selectors:
    - a[href]                    # Standard links
    - nav a                      # Navigation links
    - article a                  # Links within articles
    - .docs-sidebar a            # Sidebar navigation
    - .pagination a              # Pagination links

# Output configuration
output:
  # Base directory for all scraped sites
  base_dir: output

  # Site-specific subdirectory (enables multi-site scraping)
  # Creates output/<site_dir>/ structure
  site_dir: django-docs

  # Directory structure within site_dir
  docs_dir: docs      # Markdown files go here
  assets_dir: assets  # Images, CSS, JS go here

  # Path mapping: how URLs map to file paths
  path_mapping:
    # Mode: "auto" uses intelligent URL-to-path conversion
    mode: auto

    # Strip this prefix from URLs before mapping
    # Example: https://docs.djangoproject.com/en/stable/topics/db/ -> /topics/db/ -> topics/db.md
    strip_prefix: /en/stable

    # Filename for directory URLs (e.g., /guide/ -> guide/index.md)
    index_file: index.md

  # Markdown generation settings
  markdown:
    # Add YAML frontmatter to top of each file
    add_frontmatter: true

    # Which metadata fields to include in frontmatter
    frontmatter_fields:
      - title           # Page title from <title> tag
      - url             # Original source URL
      - scraped_at      # Timestamp when scraped
      - description     # Meta description if available
      - tags            # Keywords/tags if available

# Asset handling configuration
assets:
  # Enable asset downloads
  download: true

  # Which asset types to download
  types:
    - images          # PNG, JPG, GIF, SVG, WebP, etc.
    - css             # Stylesheets
    - js              # JavaScript files
    - fonts           # Web fonts (WOFF, WOFF2, TTF, etc.)

  # Rewrite asset URLs in markdown to relative paths
  # Links like https://docs.example.com/img/logo.png become ../assets/img/logo.png
  rewrite_paths: true

# Example usage:
# sus scrape --config examples/advanced-docs.yaml
# sus scrape --config examples/advanced-docs.yaml --dry-run
# sus scrape --config examples/advanced-docs.yaml --max-pages 50 --verbose
#
# Notes:
# - Django docs uses Sphinx static site generator
# - Has comprehensive sitemap at /sitemap.xml
# - Includes tutorials, API reference, how-to guides, and topic guides
# - ~500 pages in stable English version
